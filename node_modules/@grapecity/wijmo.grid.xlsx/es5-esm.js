/*!
    *
    * Wijmo Library 5.20201.680
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,l){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,l){e.__proto__=l}||function(e,l){for(var t in l)l.hasOwnProperty(t)&&(e[t]=l[t])})(e,l)};return function(e,l){extendStatics(e,l);function __(){this.constructor=e}e.prototype=null===l?Object.create(l):(__.prototype=l.prototype,new __)}}();import{_getModule,Globalize,DataType,asBoolean,isString,isNumber,isInt,isDate,isFunction,isNullOrWhiteSpace,isObject,asEnum,getType,copy,_registerModule}from"@grapecity/wijmo";import{FlexGrid,Row,GroupRow,Column,CellRange,CellRangeEventArgs,RowColFlags,CellType,_NewRowTemplate}from"@grapecity/wijmo.grid";import*as mXlsx from"@grapecity/wijmo.xlsx";import*as selfModule from"@grapecity/wijmo.grid.xlsx";export function softDetail(){return _getModule("wijmo.grid.detail")}export function softMultiRow(){return _getModule("wijmo.grid.multirow")}export function softTransGrid(){return _getModule("wijmo.grid.transposed")}var FlexGridXlsxConverter=function(){function FlexGridXlsxConverter(){}FlexGridXlsxConverter.save=function(e,l,t){var r=new mXlsx.Workbook;this._saveFlexGridToWorkbook(r,e,l,!1,null);t&&r.save(t);return r};FlexGridXlsxConverter.saveAsync=function(e,l,t,r,o,n){var s=this,i=null!=t,a=new mXlsx.Workbook;this.cancelAsync((function(){var u,d=[e.collectionView&&e.collectionView.collectionChanged,e.columns&&e.columns.collectionChanged,e.rows&&e.rows.collectionChanged,e.resizedColumn,e.resizedRow],removeHandlers=function(){return d.forEach((function(e){e&&e.removeHandler(restart)}))},restart=function(){clearTimeout(u);u=setTimeout((function(){removeHandlers();a=null;s.saveAsync(e,l,t,r,o,n)}),100)},finish=function(){clearTimeout(u);s._cs=null;removeHandlers()};s._cs=new mXlsx._SyncPromise(null,finish);d.forEach((function(e){e&&e.addHandler(restart)}));s._saveFlexGridToWorkbook(a,e,l,!0,s._cs,(function(e){isFunction(n)&&n(i?Math.round(mXlsx._map(e,0,100,0,50)):e)})).then((function(){if(t){a._externalCancellation=function(){return s._cs};a.saveAsync(t,(function(e){finish();isFunction(r)&&r(e,a)}),(function(e){finish();isFunction(o)&&o(e)}),(function(e){isFunction(n)&&n(Math.round(mXlsx._map(e,0,100,51,100)))}))}else{finish();isFunction(n)&&n(100);isFunction(r)&&r(null,a)}}),(function(e){finish();throw e}))}));return a};FlexGridXlsxConverter.cancelAsync=function(e){var l=this;if(this._cs){this._cs.cancel();setTimeout((function(){l._cs=null;isFunction(e)&&e()}),100)}else isFunction(e)&&e()};FlexGridXlsxConverter.load=function(e,l,t){var r=this;if(l instanceof Blob){var o=new FileReader;o.onload=function(){var l=mXlsx.Workbook._base64EncArr(new Uint8Array(o.result)),n=new mXlsx.Workbook;n.load(l);l=null;e.deferUpdate((function(){r._loadToFlexGrid(e,n,t);n=null}))};o.readAsArrayBuffer(l)}else if(l instanceof mXlsx.Workbook)e.deferUpdate((function(){r._loadToFlexGrid(e,l,t);l=null}));else{if(l instanceof ArrayBuffer)l=mXlsx.Workbook._base64EncArr(new Uint8Array(l));else if(!isString(l))throw"Invalid workbook.";var n=new mXlsx.Workbook;n.load(l);l=null;e.deferUpdate((function(){r._loadToFlexGrid(e,n,t);n=null}))}};FlexGridXlsxConverter.loadAsync=function(e,l,t,r,o){var n=this;if(l instanceof Blob){var s=new FileReader;s.onload=function(){var l=mXlsx.Workbook._base64EncArr(new Uint8Array(s.result)),i=new mXlsx.Workbook;i.loadAsync(l,(function(o){l=null;i=null;e.deferUpdate((function(){n._loadToFlexGrid(e,o,t);r&&r(o);o=null}))}),o)};s.readAsArrayBuffer(l)}else if(l instanceof mXlsx.Workbook)e.deferUpdate((function(){n._loadToFlexGrid(e,l,t);r&&r(l);l=null}));else{if(l instanceof ArrayBuffer)l=mXlsx.Workbook._base64EncArr(new Uint8Array(l));else if(!isString(l))throw"Invalid workbook.";(new mXlsx.Workbook).loadAsync(l,(function(o){l=null;e.deferUpdate((function(){n._loadToFlexGrid(e,o,t);r&&r(o);o=null}))}),o)}};FlexGridXlsxConverter._saveFlexGridToWorkbook=function(e,l,t,r,o,n){var s,i=this,a=new mXlsx._SyncPromise(o),u=new mXlsx.WorkSheet,d=!t||null==t.includeColumnHeaders||t.includeColumnHeaders,c=!(!t||null==t.includeRowHeaders)&&t.includeRowHeaders,f=_IncludeCellStyles.Cache,h=t?t.includeColumns:null,m=t?t.formatItem:null,p=0,x=c?l.rowHeaders.columns.length:0,g=[];t&&(f=!1===asBoolean(t.includeCellStyles,!0)?_IncludeCellStyles.None:!1===asBoolean(t.quickCellStyles,!0)?_IncludeCellStyles.Regular:_IncludeCellStyles.Cache);var y=f===_IncludeCellStyles.Cache?new _StyleCache(500):null;null==this.hasCssText&&(this.hasCssText="cssText"in document.body.style);var w,_=l.wj_sheetInfo;u.name=t?t.sheetName:"";u.visible=!t||!1!==t.sheetVisible;if(_&&_.tables&&_.tables.length>0)for(var C=0;C<_.tables.length;C++)u.tables.push(_.tables[C]);s=[];if(!_&&(f!==_IncludeCellStyles.None||m)){(w=document.createElement("div")).style.visibility="hidden";w.setAttribute(FlexGrid._WJS_MEASURE,"true");l.hostElement.appendChild(w)}(c?[l.rowHeaders,l.columnHeaders]:[l.columnHeaders]).forEach((function(e){for(var t=e.rows,r=e.columns,o=0,n=e.cellType===CellType.ColumnHeader?x:0,a=0;a<t.length;a++)if(!(t[a].renderSize<=0)){s[o]||(s[o]=[]);for(var c=0,f=0;c<r.length;c++){var m=l._getBindingColumn(e,a,r[c]),g=i._getColumnSetting(m,c,r);if(g){s[o][n+c]=g;if(0===o){if(e.cellType===CellType.ColumnHeader&&h&&!h(m))continue;var y=new mXlsx.WorkbookColumn;y._deserialize(g);u._addWorkbookColumn(y,n+f++)}}}o++}e.cellType===CellType.ColumnHeader&&(p=d?o:0)}));var v=[[l.topLeftCells,l.columnHeaders],[l.rowHeaders,l.cells],[l.rowHeaders,l.columnFooters]];d||v.shift();var b=v.map((function(e){return e[1].rows.length})).reduce((function(e,l){return e+l}));this._saveContentToWorksheet(o,r,Date.now(),0,{panels:v,panelIdx:0,globRowIdx:0,rowsOffset:0,totalRows:b},l,u,c,s,f,w,g,y,h,m,(function(e){n(Math.round(e/b*100))}),(function(){var r=new mXlsx.WorkbookFrozenPane;r.rows=d?l.frozenRows+p:l.frozenRows;r.columns=c?l.frozenColumns+x:l.frozenColumns;u.frozenPane=r;e._addWorkSheet(u);if(!_&&(f!==_IncludeCellStyles.None||m)){l.hostElement.removeChild(w);g.forEach((function(e){return e.forEach((function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}))}))}y&&y.clear();e.activeWorksheet=t?t.activeWorksheet:null;a.resolve()}));return a};FlexGridXlsxConverter._saveContentToWorksheet=function(e,l,t,r,o,n,s,i,a,u,d,c,f,h,m,p,x){for(var g=this,y=u?20:200,_loop_1=function(_){if(e&&e.cancelled)return{value:void 0};if(l&&_-r>y&&Date.now()-t>100){setTimeout((function(){if(!e||!e.cancelled){p(_);g._saveContentToWorksheet(e,l,Date.now(),_,o,n,s,i,a,u,d,c,f,h,m,p,x)}}),0);return{value:void 0}}if(_-o.rowsOffset>=o.panels[o.panelIdx][1].rows.length){o.rowsOffset+=o.panels[o.panelIdx][1].rows.length;o.panelIdx++}var C=o.panels[o.panelIdx],v=C[0],b=C[1],S=_-o.rowsOffset,X=b.rows[S];if(b.cellType!==CellType.Cell&&X.renderSize<=0||X instanceof _NewRowTemplate)return"continue";var k=0,F={},T=new mXlsx.WorkbookRow,R=X instanceof GroupRow,G=0;b.cellType===CellType.Cell&&(R?G=X.level:n.rows.maxGroupLevel>-1&&(G=n.rows.maxGroupLevel+1));i&&(k=w._parseFlexGridRowToSheetRow(v,F,S,0,a,u,d,c,f,R,G,h,m));w._parseFlexGridRowToSheetRow(b,F,S,k,a,u,d,c,f,R,G,h,m);if(F.cells.length>0){T._deserialize(F);s._addWorkbookRow(T,o.globRowIdx)}o.globRowIdx++},w=this,_=r;_<o.totalRows;_++){var C=_loop_1(_);if("object"==typeof C)return C.value}isFunction(x)&&x()};FlexGridXlsxConverter._loadToFlexGrid=function(e,l,t){t=t||{};var r,o=null!=e.wj_sheetInfo,n={},s=[],i=[],a={};e.itemsSource=null;e.columns.clear();e.columnHeaders.rows.clear();e.rowHeaders.columns.clear();e.rows.clear();e.frozenColumns=0;e.frozenRows=0;var u=null==t.sheetIndex||isNaN(t.sheetIndex)?0:t.sheetIndex;if(u<0||u>=l.sheets.length)throw"The sheet index option is out of the sheet range of current workbook.";if(null!=t.sheetName)for(var d=0;d<l.sheets.length;d++)if(t.sheetName===l.sheets[d].name){r=l.sheets[d];break}if(null!=(r=r||l.sheets[u]).rows){for(var c=this._getColumnCount(r.rows),f=this._getRowCount(r.rows,c),h=r.columns,m=0;m<c;m++){e.columns.push(new Column);if(h[m]){isNaN(+h[m].width)||(e.columns[m].width=+h[m].width);h[m].visible||null==h[m].visible||(e.columns[m].visible=!!h[m].visible);h[m].style&&h[m].style.wordWrap&&(e.columns[m].wordWrap=h[m].style.wordWrap)}}var p,x=(null==t.includeColumnHeaders||t.includeColumnHeaders)&&r.rows.length>0,g=x?this._getColumnHeadersHeight(r):0,y=!1,w=[],_=r.frozenPane&&r.frozenPane.rows,C=r.frozenPane&&r.frozenPane.columns;_=isNumber(_)&&!isNaN(_)?_:null;C=isNumber(C)&&!isNaN(C)?C:null;for(var v=g;v<f;v++){var b=!1,S=null,X=r.rows[v];if(X)for(var k=v+1;k<r.rows.length;){var F=r.rows[k];if(F){(isNaN(X.groupLevel)&&!isNaN(F.groupLevel)||!isNaN(X.groupLevel)&&X.groupLevel<F.groupLevel)&&(b=!0);break}k++}if(b&&!r.summaryBelow){p&&(p.isCollapsed=y);(p=new GroupRow).isReadOnly=!1;y=null!=X.collapsed&&X.collapsed;p.level=isNaN(X.groupLevel)?0:X.groupLevel;a[p.level]=y;this._checkParentCollapsed(a,p.level)&&p._setFlag(RowColFlags.ParentCollapsed,!0);e.rows.push(p)}else{var T=new Row;X&&this._checkParentCollapsed(a,X.groupLevel)&&T._setFlag(RowColFlags.ParentCollapsed,!0);e.rows.push(T)}X&&X.height&&!isNaN(X.height)&&(e.rows[v-g].height=X.height);for(m=0;m<c;m++)if(X){var R=X.cells[m],G=R?R.formula:null;G&&"="!==G[0]&&(G="="+G);if(R&&R.textRuns&&R.textRuns.length>0){e.rows[v-g].isContentHtml=!0;e.setCellData(v-g,m,this._parseTextRunsToHTML(R.textRuns))}else e.setCellData(v-g,m,G&&o?G:this._getItemValue(R));b||this._setColumn(w,m,R);var A=v*c+m,W=R?R.style:null,I=mXlsx.Workbook._parseExcelFormat(R),E=void 0;if(W){S=null==S?!!W.wordWrap:S&&!!W.wordWrap;if(W.hAlign)E=mXlsx.Workbook._parseHAlignToString(asEnum(W.hAlign,mXlsx.HAlign));else switch(this._getItemType(R)){case DataType.Number:E="right";break;case DataType.Boolean:E="center";break;default:E=I&&0===I.search(/[n,c,p]/i)?"right":"left"}n[A]={fontWeight:W.font&&W.font.bold?"bold":"none",fontStyle:W.font&&W.font.italic?"italic":"none",textDecoration:W.font&&W.font.underline?"underline":"none",textAlign:E,fontFamily:W.font&&W.font.family?W.font.family:"",fontSize:W.font&&W.font.size?W.font.size+"px":"",color:W.font&&W.font.color?W.font.color:"",backgroundColor:W.fill&&W.fill.color?W.fill.color:"",whiteSpace:W.wordWrap?"pre-wrap":"normal",format:I};if(W.borders){if(W.borders.left){this._parseBorderStyle(W.borders.left.style,"Left",n[A]);n[A].borderLeftColor=W.borders.left.color}if(W.borders.right){this._parseBorderStyle(W.borders.right.style,"Right",n[A]);n[A].borderRightColor=W.borders.right.color}if(W.borders.top){this._parseBorderStyle(W.borders.top.style,"Top",n[A]);n[A].borderTopColor=W.borders.top.color}if(W.borders.bottom){this._parseBorderStyle(W.borders.bottom.style,"Bottom",n[A]);n[A].borderBottomColor=W.borders.bottom.color}}if(W.fill&&W.fill.color){var N=n[A],D=W.borders,B=W.fill.color;if(D){D.left&&D.left.color||(N.borderLeftColor=B);D.right&&D.right.color||m===C-1||(N.borderRightColor=B);D.top&&D.top.color||(N.borderTopColor=B);D.bottom&&D.bottom.color||v===_-1||(N.borderBottomColor=B)}else{N.borderLeftColor=B;m!==C-1&&(N.borderRightColor=B);N.borderTopColor=B;v!==_-1&&(N.borderBottomColor=B)}}W.font&&-1===i.indexOf(W.font.family)&&i.push(W.font.family)}R&&isNumber(R.rowSpan)&&R.rowSpan>0&&isNumber(R.colSpan)&&R.colSpan>0&&(R.rowSpan>1||R.colSpan>1)&&s.push(new CellRange(v,m,v+R.rowSpan-1,m+R.colSpan-1))}if(X){this._checkParentCollapsed(a,X.groupLevel)||X.visible||null==X.visible||(e.rows[v-g].visible=X.visible);e.rows[v-g].wordWrap=!!X.style&&!!X.style.wordWrap||!!S}}p&&(p.isCollapsed=y);null!=C&&(e.frozenColumns=C);null!=_&&(e.frozenRows=x&&_>0?_-1:_);for(m=0;m<e.columnHeaders.columns.length;m++){var H=w[m],M=e.columns[m];M.isRequired=!1;if(H){H.dataType===DataType.Boolean&&(M.dataType=H.dataType);M.format=H.format;M.align=H.hAlign;M.wordWrap=M.wordWrap||!!H.wordWrap}}for(d=0;d<Math.max(g,1);d++)e.columnHeaders.rows.push(new Row);var z=Object.keys(r.rows);for(d=0;d<g;d++)for(var O=0;O<r.columns.length;O++){var j=r.rows[z[d]].cells[O],L=j&&j.value||"",P=e.columnHeaders.columns[O];if(L){var V=mXlsx.Workbook._parseExcelFormat(j);L=Globalize.format(L,V)}P.header=P.header||L;e.columnHeaders.setCellData(d,O,L)}if(o){var U=null==t.sheetVisible||t.sheetVisible;e.wj_sheetInfo.name=r.name;e.wj_sheetInfo.visible=!0===U||!1!==r.visible;e.wj_sheetInfo.styledCells=n;e.wj_sheetInfo.mergedRanges=s;e.wj_sheetInfo.fonts=i;e.wj_sheetInfo.tables=r.tables}}};FlexGridXlsxConverter._getColumnHeadersHeight=function(e){if(!e&&!e.rows.length)return 0;for(var l=1,t=0;t<e.rows.length;t++){var r=e.rows[t];if(r){r.cells.forEach((function(e){l=Math.max(l,e.rowSpan||0)}));break}}return l};FlexGridXlsxConverter._escapePlainText=function(e){return null==e?"":""===e?"'":e&&("'"===e[0]||e.length>1&&"="===e[0]&&"="===e[1])?"'"+e:e};FlexGridXlsxConverter._parseFlexGridRowToSheetRow=function(e,l,t,r,o,n,s,i,a,u,d,c,f){var h,m,p,x,g,y,w,_,C,v,b,S,X,k,F,T,R,G,A,W,I,E,N,D,B,H,M,z,O,j,L=!1,P=!1;(A=(h=e.grid).wj_sheetInfo)&&(W=A.evaluateFormula);if(null==(m=e.rows[t]).recordIndex){D=0;e.cellType===CellType.ColumnHeader&&e.rows.length>1&&(D=t===o.length?t-1:t)}else D=m.recordIndex;l.cells||(l.cells=[]);l.visible=m.isVisible;l.height=m.renderHeight||e.rows.defaultSize;l.groupLevel=d;u&&(l.collapsed=m.isCollapsed);m.wordWrap&&(l.style={wordWrap:m.wordWrap});(m.constructor===Row||m.constructor===_NewRowTemplate||softTransGrid()&&h instanceof softTransGrid().TransposedGrid&&m instanceof Row||softDetail()&&m.constructor===softDetail().DetailRow||softMultiRow()&&m.constructor===softMultiRow()._MultiRow)&&(L=!0);softDetail()&&m.constructor===softDetail().DetailRow&&(P=!0);for(x=0;x<e.columns.length;x++){g=null;G=1;R=1;O=0;N=!1;F=null;null;H=null;_=null;E=h._getBindingColumn(e,t,e.columns[x]);T=null;if(A&&e===h.cells){k=t*e.columns.length+x;A.mergedRanges&&(T=this._getMergedRange(t,x,A.mergedRanges));A.styledCells&&(F=A.styledCells[k])}else if(n!==_IncludeCellStyles.None){H=this._getMeasureCell(e,x,s,i);F=(T=h.getMergedRange(e,t,x,!1))?this._getCellStyle(e,H,T.bottomRow,T.rightCol,a)||{}:this._getCellStyle(e,H,t,x,a)||{}}T||(T=h.getMergedRange(e,t,x,!1));if(T){if(t===T.topRow&&x===T.leftCol){R=T.bottomRow-T.topRow+1;G=this._getColSpan(e,T,c);N=!0}}else N=!0;if(!c||c(E)){p=o[D]?o[D][x+r]:null;if(L||u){w=N?e.getCellData(t,x,!0):null;C=N?e.getCellData(t,x,!1):null;b=this._isFormula(w);X=null;I=isDate(C);if(F&&F.format&&null!=C){g=F.format;/[hsmyt\:]/i.test(g)&&(I=!0);y=mXlsx.Workbook._parseCellFormat(F.format,I)}else if(p&&p.style&&p.style.format){g=E.format;y=p.style.format}else y=null;b&&null!=W&&isFunction(W)&&(X=W(w));if(!y)if(I)y="m/d/yyyy";else if(isNumber(C)&&!E.dataMap)y=isInt(C)?"#,##0":"#,##0.00";else if(b){if((S=w.toLowerCase()).indexOf("now()")>-1){y="m/d/yyyy h:mm";I=!0}else if(S.indexOf("today()")>-1||S.indexOf("date(")>-1){y="m/d/yyyy";I=!0}else if(S.indexOf("time(")>-1){y="h:mm AM/PM";I=!0}}else y="General"}else{w=N?h.columnHeaders.getCellData(0,x,!0):null;y="General"}if(isString(w)&&-1!==w.indexOf("<span")){_=this._parseToTextRuns(w);w=null}M=this._parseCellStyle(F)||{};if(e===h.cells&&u&&m.hasChildren&&x===h.columns.firstVisibleIndex){b&&null!=X?v=X:w?v=w:N&&(v=m.getGroupHeader().replace(/<\/?\w+>/g,"").replace(/&#39;/g,"'"));if(null==v&&!F)continue;!(I=isDate(v))&&g&&"d"===g.toLowerCase()&&isInt(v)&&(y="0");v=isString(v)?mXlsx.Workbook._unescapeXML(v):v;x===h.columns.firstVisibleIndex&&h.treeIndent&&(O=d);B={value:v,isDate:I,formula:b?this._parseToExcelFormula(w,I):null,colSpan:G,rowSpan:R,style:this._extend(M,{format:y,font:{bold:!0},hAlign:mXlsx.HAlign.Left,indent:O}),textRuns:_}}else{w=isString(w)?mXlsx.Workbook._unescapeXML(w):w;C=isString(C)?mXlsx.Workbook._unescapeXML(C):C;!I&&g&&"d"===g.toLowerCase()&&isInt(C)&&(y="0");z=M&&M.hAlign?M.hAlign:p&&p.style&&null!=p.style.hAlign?asEnum(p.style.hAlign,mXlsx.HAlign,!0):isDate(C)?mXlsx.HAlign.Left:mXlsx.HAlign.General;x!==h.columns.firstVisibleIndex||!h.treeIndent||z!==mXlsx.HAlign.Left&&z!==mXlsx.HAlign.General||(O=d);B={value:b?X:"General"!==y||""===w&&null==C?this._escapePlainText(C):this._escapePlainText(w),isDate:I,formula:b?this._parseToExcelFormula(w,I):null,colSpan:x<h.columns.firstVisibleIndex?1:G,rowSpan:R,style:this._extend(M,{format:y,hAlign:z,vAlign:R>1?e===h.cells||!1===h.centerHeadersVertically?mXlsx.VAlign.Top:mXlsx.VAlign.Center:null,indent:O}),textRuns:_};P&&(j=e.getCellElement(t,x))&&j.appendChild(m.detail)}f&&f(new XlsxFormatItemEventArgs(e,new CellRange(t,x),H,s,i,a,B));l.cells.push(B)}}return r+x};FlexGridXlsxConverter._parseCellStyle=function(e,l){void 0===l&&(l=!1);if(null==e)return null;var t=e.fontSize;t=t?+t.substring(0,t.indexOf("px")):null;isNaN(t)&&(t=null);var r=e.fontWeight;r="bold"===r||+r>=700;var o="italic"===e.fontStyle,n=e.textDecorationStyle;null==n&&(n=e.textDecoration);n="underline"===n;var s=e.whiteSpace;s=!!s&&s.indexOf("pre")>-1;return{font:{bold:r,italic:o,underline:n,family:this._parseToExcelFontFamily(e.fontFamily),size:t,color:e.color},fill:{color:e.backgroundColor},borders:this._parseBorder(e,l),hAlign:mXlsx.Workbook._parseStringToHAlign(e.textAlign),wordWrap:s}};FlexGridXlsxConverter._parseBorder=function(e,l){var t={};t.left=this._parseEgdeBorder(e,"Left");t.right=this._parseEgdeBorder(e,"Right");t.top=this._parseEgdeBorder(e,"Top");t.bottom=this._parseEgdeBorder(e,"Bottom");if(l){t.vertical=this._parseEgdeBorder(e,"Vertical");t.horizontal=this._parseEgdeBorder(e,"Horizontal")}return t};FlexGridXlsxConverter._parseEgdeBorder=function(e,l){var t,r=e["border"+l+"Style"],o=e["border"+l+"Width"];o&&o.length>2&&(o=+o.substring(0,o.length-2));if(r&&"none"!==r&&"hidden"!==r){t={};switch(r=r.toLowerCase()){case"dotted":t.style=o>1?mXlsx.BorderStyle.MediumDashDotted:mXlsx.BorderStyle.Dotted;break;case"dashed":t.style=o>1?mXlsx.BorderStyle.MediumDashed:mXlsx.BorderStyle.Dashed;break;case"double":t.style=mXlsx.BorderStyle.Double;break;default:t.style=o>2?mXlsx.BorderStyle.Thick:o>1?mXlsx.BorderStyle.Medium:mXlsx.BorderStyle.Thin}t.color=e["border"+l+"Color"]}return t};FlexGridXlsxConverter._parseBorderStyle=function(e,l,t){var r="border"+l+"Style",o="border"+l+"Width";switch(e){case mXlsx.BorderStyle.Dotted:case mXlsx.BorderStyle.Hair:t[r]="dotted";t[o]="1px";break;case mXlsx.BorderStyle.Dashed:case mXlsx.BorderStyle.ThinDashDotDotted:case mXlsx.BorderStyle.ThinDashDotted:t[r]="dashed";t[o]="1px";break;case mXlsx.BorderStyle.MediumDashed:case mXlsx.BorderStyle.MediumDashDotDotted:case mXlsx.BorderStyle.MediumDashDotted:case mXlsx.BorderStyle.SlantedMediumDashDotted:t[r]="dashed";t[o]="2px";break;case mXlsx.BorderStyle.Double:t[r]="double";t[o]="3px";break;case mXlsx.BorderStyle.Medium:t[r]="solid";t[o]="2px";break;case mXlsx.BorderStyle.Thick:t[r]="solid";t[o]="3px";break;default:t[r]="solid";t[o]="1px"}};FlexGridXlsxConverter._parseToExcelFontFamily=function(e){var l;e&&(l=e.split(","))&&l.length>0&&(e=l[0].replace(/\"|\'/g,""));return e};FlexGridXlsxConverter._parseToExcelFormula=function(e,l){var t,r,o,n,s,i,a,u=/\"?\w+\"?\s*\,\s*\"(\w+)\"/i;if(t=e.match(/(floor|ceiling)\([+-]?\d+\.?\d*\)/gi))for(s=0;s<t.length;s++){a=(i=t[s]).substring(0,i.lastIndexOf(")"))+", 1)";e=e.replace(i,a)}t=null;if(t=e.match(/text\(\"?\w+\"?\s*\,\s*\"\w+\"\)/gi))for(s=0;s<t.length;s++)if((r=(i=t[s]).match(u))&&2===r.length){o=r[1];if(!/^d{1,4}?$/.test(o)){n=mXlsx.Workbook._parseCellFormat(o,l);a=i.replace(o,n);e=e.replace(i,a)}}return e};FlexGridXlsxConverter._parseToTextRuns=function(e){var l,t,r,o=e.split("<span "),n=[];for(l=0;l<o.length;l++){r=-1!==(t=o[l]).indexOf("</span>")?{text:t.substring(t.indexOf(">")+1,t.indexOf("</span>")),font:this._parseToTextRunFont(t.substring(t.indexOf('style="')+7,t.indexOf(';"')))}:{text:t};n.push(r)}return n};FlexGridXlsxConverter._parseToTextRunFont=function(e){var l,t,r,o,n,s,i,a,u,d=e.split(";");if(d.length>0){for(l=0;l<d.length;l++)if(2===(t=d[l].split(":")).length){t[1]=t[1].trim();switch(t[0]){case"font-size":s=+t[1].substring(0,t[1].indexOf("px"));isNaN(s)&&(s=null);break;case"font-weight":r="bold"===t[1]||+t[1]>=700;break;case"font-style":o="italic"===t[1];break;case"text-decoration-style":case"text-decoration":n="underline"===t[1];break;case"font-family":i=this._parseToExcelFontFamily(t[1]);break;case"color":a=t[1]}}u={bold:r,italic:o,underline:n,family:i,size:s,color:a}}return u};FlexGridXlsxConverter._getMeasureCell=function(e,l,t,r){var o=r[e.cellType],n=o&&o[l],s=null==n;if(n){if(this.hasCssText){n.style;n.style.cssText="";n.style.visibility="hidden"}}else{o||(r[e.cellType]=o=[]);o[l]=n=t.cloneNode()}!s&&n.parentElement||(e.hostElement.children.length>0?e.hostElement.children[0].appendChild(n):e.hostElement.appendChild(n));return n};FlexGridXlsxConverter._getColumnSetting=function(e,l,t){var r=e;null!=e.colspan&&(r=this._getRenderColumn(l,t));return r?{autoWidth:!0,width:r.renderWidth||t.defaultSize,visible:r.visible,style:{format:r.format?mXlsx.Workbook._parseCellFormat(r.format,r.dataType===DataType.Date):"",hAlign:mXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(r.getAlignment())),wordWrap:r.wordWrap}}:null};FlexGridXlsxConverter._toExcelHAlign=function(e){return(e=e?e.trim().toLowerCase():e)?e.indexOf("center")>-1?"center":e.indexOf("right")>-1||e.indexOf("end")>-1?"right":e.indexOf("justify")>-1?"justify":"left":e};FlexGridXlsxConverter._getColumnCount=function(e){for(var l,t=0,r=0,o=0;o<e.length;o++)if((l=e[o]&&e[o].cells?e[o].cells:[])&&l.length>0){r=l.length;isInt(l[r-1].colSpan)&&l[r-1].colSpan>1&&(r=r+l[r-1].colSpan-1);r>t&&(t=r)}return t};FlexGridXlsxConverter._getRowCount=function(e,l){for(var t,r,o=e.length,n=o-1,s=0;s<l;s++)e:for(;n>=0;n--)if((r=((t=e[n])&&t.cells?t.cells:[])[s])&&(null!=r.value&&""!==r.value||isInt(r.rowSpan)&&r.rowSpan>1)){isInt(r.rowSpan)&&r.rowSpan>1&&n+r.rowSpan>o&&(o=n+r.rowSpan);break e}return o};FlexGridXlsxConverter._numAlpha=function(e){var l=Math.floor(e/26)-1;return(l>-1?this._numAlpha(l):"")+String.fromCharCode(65+e%26)};FlexGridXlsxConverter._getItemType=function(e){return null==e||null==e.value||isNaN(e.value)?null:getType(e.value)};FlexGridXlsxConverter._setColumn=function(e,l,t){var r,o,n,s=e[l];if(s){r=this._getItemType(t);s.dataType!==r&&s.dataType===DataType.Boolean&&r!==DataType.Boolean&&(s.dataType=r);!t||null==t.value||isString(t.value)&&isNullOrWhiteSpace(t.value)||(o=mXlsx.Workbook._parseExcelFormat(t))&&s.format!==o&&"General"!==o&&(s.format=o);if(t&&t.style){t.style.hAlign&&(n=mXlsx.Workbook._parseHAlignToString(asEnum(t.style.hAlign,mXlsx.HAlign)));null==s.wordWrap?s.wordWrap=!!t.style.wordWrap:s.wordWrap=s.wordWrap&&!!t.style.wordWrap}n||r!==DataType.Number||(n="right");s.hAlign=n}else e[l]={dataType:this._getItemType(t),format:mXlsx.Workbook._parseExcelFormat(t),hAlign:"",wordWrap:null}};FlexGridXlsxConverter._getItemValue=function(e){if(null==e||null==e.value)return null;var l=e.value;isString(l)&&"'"===l[0]&&(l=l.substr(1));return isNumber(l)&&isNaN(l)?"":l instanceof Date&&isNaN(l.getTime())?"":l};FlexGridXlsxConverter._getCellStyle=function(e,l,t,r,o){var n;try{e.grid.cellFactory.updateCell(e,t,r,l,null,!o&&void 0);l.className=l.className.replace("wj-state-selected","");l.className=l.className.replace("wj-state-multi-selected","")}catch(e){return null}if(o){var s,i=e.hostElement,a=l;s=a.style.cssText.split(/;\s+/).filter((function(e){var l=e.substring(0,e.indexOf(":"));return/^(color|background|border|font|text|whitespace)/i.test(l)})).join(";");do{s=a.className+s}while(a!==i&&(a=a.parentElement));if(!(n=o.getValue(s))){n=window.getComputedStyle(l);o.add(s,n)}}else n=window.getComputedStyle(l);return n};FlexGridXlsxConverter._parseTextRunsToHTML=function(e){var l,t,r,o;r="";for(o=0;o<e.length;o++)r+=(t=(l=e[o]).font)?'<span style="'+(t.bold?"font-weight: bold;":"")+(t.italic?"font-style: italic;":"")+(t.underline?"text-decoration: underline;":"")+(t.family?"font-family: "+t.family+";":"")+(null!=t.size?"font-size: "+t.size+"px;":"")+(t.color?"color: "+t.color+";":"")+'">'+l.text+"</span>":l.text;return r};FlexGridXlsxConverter._extend=function(e,l){for(var t in l){var r=l[t];isObject(r)&&e[t]?copy(e[t],r):e[t]=r}return e};FlexGridXlsxConverter._checkParentCollapsed=function(e,l){var t=!1;Object.keys(e).forEach((function(r){!0===e[r]&&!1===t&&!isNaN(l)&&+r<l&&(t=!0)}));return t};FlexGridXlsxConverter._getColSpan=function(e,l,t){for(var r=0,o=l.leftCol;o<=l.rightCol;o++)t&&!t(e.columns[o])||r++;return r};FlexGridXlsxConverter._getRenderColumn=function(e,l){return e>=l.length?null:l[e]};FlexGridXlsxConverter._getMergedRange=function(e,l,t){var r,o;for(r=0;r<t.length;r++)if(e>=(o=t[r]).topRow&&e<=o.bottomRow&&l>=o.leftCol&&l<=o.rightCol)return o;return null};FlexGridXlsxConverter._isFormula=function(e){return e&&"string"==typeof e&&e.length>1&&"="===e[0]&&"="!==e[1]};return FlexGridXlsxConverter}();export{FlexGridXlsxConverter};var _IncludeCellStyles,XlsxFormatItemEventArgs=function(e){__extends(XlsxFormatItemEventArgs,e);function XlsxFormatItemEventArgs(l,t,r,o,n,s,i){var a=e.call(this,l,t)||this;a._cell=r;a._patternCell=o;a._xlsxCell=i;a._cellsCache=n;a._styleCache=s;return a}Object.defineProperty(XlsxFormatItemEventArgs.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0});Object.defineProperty(XlsxFormatItemEventArgs.prototype,"xlsxCell",{get:function(){return this._xlsxCell},set:function(e){this._xlsxCell=e},enumerable:!0,configurable:!0});XlsxFormatItemEventArgs.prototype.getFormattedCell=function(){if(!this._cell){this._cell=FlexGridXlsxConverter._getMeasureCell(this.panel,this.col,this._patternCell,this._cellsCache);FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.row,this.col,this._styleCache)}return this._cell};return XlsxFormatItemEventArgs}(CellRangeEventArgs);export{XlsxFormatItemEventArgs};!function(e){e[e.None=0]="None";e[e.Regular=1]="Regular";e[e.Cache=2]="Cache"}(_IncludeCellStyles||(_IncludeCellStyles={}));var _StyleCache=function(){function _StyleCache(e){this._cache={};this._size=0;this._max=e}_StyleCache.prototype.add=function(e,l){this._size>=this._max&&this.clear();this._cache[e]=this._cloneStyle(l);this._size++};_StyleCache.prototype.clear=function(){this._cache={};this._size=0};_StyleCache.prototype.getValue=function(e){return this._cache[e]||null};_StyleCache.prototype.hasKey=function(e){return!!this._cache[e]};_StyleCache.prototype._cloneStyle=function(e){if(!e)return null;for(var l={},toCamel=function(e){return e.replace(/\-([a-z])/g,(function(e,l,t){return t>0?l.toUpperCase():l}))},t=0,r=e.length;t<r;t++){var o=e[t];l[toCamel(o)]=e.getPropertyValue(o)}return l};return _StyleCache}();export{_StyleCache};_registerModule("wijmo.grid.xlsx",selfModule);